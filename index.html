<html>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<head>
		<style> 
			input: {type: number;}
		</style>
	</head>
	<body>
		<form id="form">
		Damage<br><input inputmode="numeric" name="Damage" onchange="calc()" oninput="calc()" id="dmg"><br><br>
		Reload<br><input type="number" onchange="calc()" oninput="calc()" id="reload"><br><br>
		Fire Rate<br><input type="number" onchange="calc()" oninput="calc()" id="rate"><br><br>
		Magazine Size<br><input type="number" onchange="calc()" oninput="calc()" id="mag"><br><br>
		Elemental DPS<br><input type="number" onchange="calc()" oninput="calc()" id="edps"><br><br>
		Elemental Chance<br><input type="number" onchange="calc()" oninput="calc()" id="epct"><br><br>
		Effective DPS<br><input type="number" onchange="calc()" oninput="calc()" id="dps"><br><br>
		<br>
		<button onclick="reset()";>Reset</button>
		<input type="submit" style="opacity:0;" onSubmit="next()">
		<p id="test">test</p>
		</form>
		<script>
			form=document.getElementById("form")
			inputs = ['dmg', 'reload', 'rate', 'mag', 'edps', 'epct', 'dps'];
			function test(e){document.getElementById('test').innerText = e.key + " - " + e.code; console.log(e)}
			document.onkeypress = test
			if(form.attachEvent)
				form.attachEvent("submit", next);
			else
				form.addEventListener("submit", next);

			function next(e)
			{
				if(e.preventDefault) e.preventDefault();
				idx = inputs.indexOf(document.activeElement.id)
				//this produces an error "Cannot read property 'focus' of null" on last input field
				if(idx > -1 && idx<(inputs.length)){
					document.getElementById(inputs[idx+1]).focus();
				}
			}
			function isNumeric(n) 
			{
				return !isNaN(parseFloat(n)) && isFinite(n);
			}
			function getvalfromid(id)
			{
				e = document.getElementById(id)
				if(isNumeric(e.value))
				{
					e.style.backgroundColor = ""
					return e.value
				}
				else if(e.value != "")
					e.style.backgroundColor = "indianred"
				else if(e.value == "" && e != document.activeElement)
					e.value = e.name
				return null
			}
			function reset()
			{
				console.log("resetting")
				for (id of inputs)
					document.getElementById(id).value = "";
			}
			function calc()
			{
				dmg = getvalfromid('dmg')
				reload = getvalfromid('reload')
				rate = getvalfromid('rate')
				mag = getvalfromid('mag')
				edps = getvalfromid('edps')
				epct = getvalfromid('epct')
				dps = 0
				if(dmg && reload && rate && mag)
					dps = (dmg*mag)/(mag/rate + reload)
				if(epct && edps)
					dps += edps*(epct/100)
				console.log("dps is ", dps)
				if(dps)
					document.getElementById('dps').value = dps

			}
		</script>
	</body>
</html>