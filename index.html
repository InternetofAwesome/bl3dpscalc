<html>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<head>
	</head>
	<body>
		<form id="frm">
		Damage<br><input inputmode="numeric" name="Damage" onchange="calc()" oninput="calc()" id="dmg"><br><br>
		Reload<br><input inputmode="numeric" onchange="calc()" oninput="calc()" id="reload"><br><br>
		Fire Rate<br><input inputmode="numeric" onchange="calc()" oninput="calc()" id="rate"><br><br>
		Magazine Size<br><input inputmode="numeric" onchange="calc()" oninput="calc()" id="mag"><br><br>
		Elemental DPS<br><input inputmode="numeric" onchange="calc()" oninput="calc()" id="edps"><br><br>
		Elemental Chance<br><input inputmode="numeric" onchange="calc()" oninput="calc()" id="epct"><br><br>
		Effective DPS<br><input inputmode="numeric" onchange="calc()" oninput="calc()" id="dps"><br><br>
		<br>
		<!-- <button onclick="reset()";>Reset</button> reset screws things up for some reason.-->
		<input type="submit" style="opacity:0;"></input>
		</form>
		<script>
			frm=document.getElementById("frm")
			inputs = ['dmg', 'reload', 'rate', 'mag', 'edps', 'epct', 'dps'];
			// if(frm.attachEvent)
			// 	frm.attachEvent("submit", nextInput, false);
			// else
			// 	frm.addEventListener("submit", nextInput, false);
			window.addEventListener("submit", nextInput, true);
			HTMLFormElement.prototype.submit = nextInput
			function nextInput(e)
			{
				console.log("value: " + document.activeElement.value)
				if(e.preventDefault) e.preventDefault();
				e.preventDefault()
				e.stopImmediatePropagation();
				
				idx = inputs.indexOf(document.activeElement.id)
				//this produces an error "Cannot read property 'focus' of null" on last input field
				if(idx > -1 && idx<(inputs.length)){
					document.getElementById(inputs[idx+1]).focus();
				}
				return true
			}
			function isNumeric(n) 
			{
				return !isNaN(parseFloat(n)) && isFinite(n);
			}
			function getvalfromid(id)
			{
				e = document.getElementById(id)
				if(isNumeric(e.value))
				{
					e.style.backgroundColor = ""
					return parseFloat(e.value)
				}
				else if(e.value != "")
					e.style.backgroundColor = "indianred"
				// else if(e.value == "" && e != document.activeElement)
				// 	e.value = e.name
				return null
			}
			function reset()
			{
				alert("asdf")
				console.log("resetting")
				for (id of inputs)
					document.getElementById(id).value = "";
			}
			function calc()
			{
				dmg = getvalfromid('dmg')
				reload = getvalfromid('reload')
				rate = getvalfromid('rate')
				mag = getvalfromid('mag')
				edps = getvalfromid('edps')
				epct = getvalfromid('epct')
				dps = 0
				if(dmg && reload && rate && mag)
					dps = (dmg*mag)/(mag/rate + reload)
				if(epct && edps)
					dps += edps*(epct/100)
				console.log("dps is ", dps)
				if(dps)
					document.getElementById('dps').value = Math.round(dps)

			}
		</script>
	</body>
</html>